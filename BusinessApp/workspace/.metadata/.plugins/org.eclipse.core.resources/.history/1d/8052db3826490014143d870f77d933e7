<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<%@ page import="ua.com.bitlab.springsecuritydemo.services.security.SecurityUtils" %>
<%@ page import="java.util.HashMap, com.fervil.spring.careercoach.util.Constants, java.io.*" %>
<%@page import="java.io.File"%>

<!DOCTYPE html>
<html lang="en">

<head>
	<title>Selecting your coach</title>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<meta charset="utf-8" />
	<meta name="description" content="WEISS - HTML5 Responsive Template" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<%-- BEGIN Header No Side test --%>
<%-- END Header No Side test --%>

	<%@ include file="/WEB-INF/views/common/header_no_side_head.jsp" %>

</head>
<body >

<%-- BEGIN BODY No Side test --%>
<%-- END BODY No Side test --%>

	<%@ include file="/WEB-INF/views/common/header_no_side_body.jsp" %>
			
		<!-- CONTACT FORM -->
		<form:form method="post" commandName="coachingRequest">
				<table>
					<thead>
						<tr>
						<th>LIST OF COACHES </th>
						<!--  <th>Payment Terms</th>  -->
						</tr>
					</thead>
					<%
						String finalPath = request.getContextPath();
					
						response.setContentType("image/gif");  
						OutputStream o = response.getOutputStream();
					%>
					<tbody>
						<c:forEach items="${userProfiles}" varStatus="status" var="userProfileDetails">
								<c:set var="averageRate1" value ="${userProfileDetails.rating}"/>

								<c:set var="tmpprofileId" value ="${userProfileDetails.user_profile_id}" />
								<% String finalURL = finalPath + Constants.UPLOAD_DIRECTORY + "/" + pageContext.getAttribute("tmpprofileId") + "/" + "USERPROFILEIMAGE" + pageContext.getAttribute("tmpprofileId") + ".jpg"; 
								
									ServletContext app = getServletContext();
									String path1 = app.getRealPath(".." + finalURL);
									
									File theImage1 = new File(path1);									
								
									if(!theImage1.exists())
									{
										//finalURL = "/spring-security-demo-2CCUP/general/nopicture.png"; 
										//finalURL = "${pageContext.request.contextPath}${pageContext.request.contextPath}/images/general/nopicture.png"; 
										finalURL = finalPath + "/images/general/nopicture.png"; //used for image below in source field  inital value was in JSP script src=finalURL "

									}	
								%>
								
								<tr> 
									<td class="leftalign" width="125px;" height="115px" >
											<a href="profile?profileId=${userProfileDetails.user_profile_id}"><img id="photo2" src="<%= o.write(${userProfileDetails.user_profile_id}) %>" width="125px;" height="115px"/></a>
											<%-- <img src="data:image/jpeg;,<c:out value='${userProfileDetails.profilepicturestring}'/>" /> --%>
									</td>																		
								
									<td class="leftalign" width="100%"> <br> 
										 <b> &nbsp;&nbsp;<a href="profile?profileId=${userProfileDetails.user_profile_id}"><font color="blue" style="font-size:16px">${userProfileDetails.display_name}</font></a></b> &nbsp;&nbsp;<%@ include file="/WEB-INF/views/common/average_rating.jsp" %>	
										 <br> <b>&nbsp;&nbsp;City::::<%=path1%></b> ${userProfileDetails.city} || ${userProfileDetails.profilepicturestring} &nbsp;&nbsp;<b>State/Province: </b> ${userProfileDetails.state} 
									     <br><b>&nbsp;&nbsp;# Clients:</b> ${userProfileDetails.num_clients} 
									      &nbsp;&nbsp;<b> Packages from:</b>&nbsp;$${userProfileDetails.packages_from} 
									      &nbsp;&nbsp;<b>Coaching Categories: </b>${userProfileDetails.coaching_category_name1} - ${userProfileDetails.coaching_category_name2} - ${userProfileDetails.coaching_category_name3} 
										<br><br>
									 </td>
								</tr>
								<tr>
									<td class="leftalign" colspan="3">
									     ${userProfileDetails.overview} 
									     <br><a href="profile?profileId=${userProfileDetails.user_profile_id}"><font color="blue" size="14"><ul>See Details and Video</ul></font></a> <br><br>
									</td>      
								 </tr>
								 
								 <c:set var="userProfileId" value ="${userProfile.userProfileId}"/>
								 <!-- <td><c:out value="${customerId}" /></td> -->
						</c:forEach>
					</tbody>	
			</table>
		<!--  This section is opened in header_no_side.jsp -->
		</section>
		
		<!-- SIDEBAR -->
		
		<%-- 
		<section id="sidebar">
			<!-- SUB NAVIGATION -->
			<section>
					<p style="font-size:150%"><br><br>Your available coaches are listed.  <br><br> Please select the "Service Details" link to get more information about the coach and the services offered.
			</section>
		</section>	
		--%>
			
	</form:form>
</section>
<%@ include file="/WEB-INF/views/common/footer_no_side.jsp" %>